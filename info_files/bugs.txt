# Wrong behaviour:

First a sell order is placed, then immediately after it is placed it is canceled because it is no longer relevant.


Saids-MBP:lykke_market_maker said.salem$ python3.6 main.py 
2018-06-20 12:47:33,152 - INFO - Starting Bot ...
2018-06-20 12:47:33,661 - INFO - Fetching free balance ...
2018-06-20 12:47:33,919 - INFO - ETH: Total balance: 0.06191844
2018-06-20 12:47:33,919 - INFO - ETH: Free balance: 0.00000844
2018-06-20 12:47:33,920 - INFO - WAX: Total balance: 103.72000000
2018-06-20 12:47:33,920 - INFO - WAX: Free balance: 103.72000000
2018-06-20 12:47:33,920 - INFO - pair: WAX/ETH, coin: WAX, order size: 103.72000000
2018-06-20 12:47:33,920 - INFO - pair: WAX/ETH, coin: ETH, order size: 0.00000844
2018-06-20 12:47:33,920 - INFO - 
2018-06-20 12:47:33,920 - INFO - Entering place_orders function...
2018-06-20 12:47:33,920 - INFO - Getting reference market order book for: WAX/ETH
2018-06-20 12:47:36,117 - INFO - Current best bid at: 0.00004100
2018-06-20 12:47:36,118 - INFO - Current best ask at: 0.03897700
2018-06-20 12:47:36,118 - INFO - Calculating difference between two last orders, lowest diff: bids
2018-06-20 12:47:36,118 - INFO - Calculating difference between two last orders, lowest diff: asks
2018-06-20 12:47:36,119 - INFO - Is current orders at best: {'bid': True, 'ask': False}
2018-06-20 12:47:36,119 - INFO - Spread is about: 94965.85%
2018-06-20 12:47:36,119 - INFO - Checking whether bid and ask are better then ref market: {'bid': True, 'ask': True}
2018-06-20 12:47:36,119 - INFO - Found placed orders on trading market
2018-06-20 12:47:36,374 - INFO - checking current bid status 'open': 19eb87f4-198f-4709-8cae-dbe3b171eb62
2018-06-20 12:47:36,374 - INFO - checking whether bid price: 0.00004100 is relevant
2018-06-20 12:47:36,375 - INFO - Too small amount to place
2018-06-20 12:47:36,375 - INFO - WAX: amount: 0 < 2.5
2018-06-20 12:47:36,375 - INFO - ------------------  1e-06 addition
2018-06-20 12:47:36,376 - INFO - Placing ask order, price: 0.038976, amount: 103.72
2018-06-20 12:47:36,634 - INFO - 
2018-06-20 12:47:36,634 - INFO - going to sleep for: 15 seconds

2018-06-20 12:47:51,639 - INFO - Fetching free balance ...
2018-06-20 12:47:51,893 - INFO - ETH: Total balance: 0.06191844
2018-06-20 12:47:51,893 - INFO - ETH: Free balance: 0.00000844
2018-06-20 12:47:51,894 - INFO - WAX: Total balance: 103.72000000
2018-06-20 12:47:51,894 - INFO - WAX: Free balance: 0.00000000
2018-06-20 12:47:51,894 - INFO - pair: WAX/ETH, coin: WAX, order size: 103.72000000
2018-06-20 12:47:51,895 - INFO - pair: WAX/ETH, coin: ETH, order size: 0.00000844
2018-06-20 12:47:51,895 - INFO - 
2018-06-20 12:47:51,895 - INFO - Entering place_orders function...
2018-06-20 12:47:51,896 - INFO - Getting reference market order book for: WAX/ETH
2018-06-20 12:47:52,140 - INFO - Current best bid at: 0.00004100
2018-06-20 12:47:52,140 - INFO - Current best ask at: 0.03897600
2018-06-20 12:47:52,141 - INFO - Calculating difference between two last orders, lowest diff: bids
2018-06-20 12:47:52,141 - INFO - Calculating difference between two last orders, lowest diff: asks
2018-06-20 12:47:52,141 - INFO - Is current orders at best: {'bid': True, 'ask': False}
2018-06-20 12:47:52,141 - INFO - Spread is about: 94963.41%
2018-06-20 12:47:52,142 - INFO - Checking whether bid and ask are better then ref market: {'bid': True, 'ask': True}
2018-06-20 12:47:52,142 - INFO - Found placed orders on trading market
2018-06-20 12:47:52,396 - INFO - checking current bid status 'open': 19eb87f4-198f-4709-8cae-dbe3b171eb62
2018-06-20 12:47:52,397 - INFO - checking whether bid price: 0.00004100 is relevant
2018-06-20 12:47:52,645 - INFO - checking current ask status 'open': 9ed61583-15ce-4f6a-a175-0e13ffd4476d
2018-06-20 12:47:52,646 - INFO - checking whether ask price: 0.03897600 is relevant
2018-06-20 12:47:52,646 - INFO - Order is opened and irrelevant. Cancellation...
2018-06-20 12:47:52,646 - INFO - try to cancel ask order: 9ed61583-15ce-4f6a-a175-0e13ffd4476d
2018-06-20 12:47:52,903 - INFO - 
2018-06-20 12:47:52,903 - INFO - going to sleep for: 15 seconds

2018-06-20 12:48:07,905 - INFO - Fetching free balance ...
2018-06-20 12:48:08,153 - INFO - ETH: Total balance: 0.06191844
2018-06-20 12:48:08,153 - INFO - ETH: Free balance: 0.00000844
2018-06-20 12:48:08,153 - INFO - WAX: Total balance: 103.72000000
2018-06-20 12:48:08,154 - INFO - WAX: Free balance: 103.72000000
2018-06-20 12:48:08,154 - INFO - pair: WAX/ETH, coin: WAX, order size: 103.72000000
2018-06-20 12:48:08,154 - INFO - pair: WAX/ETH, coin: ETH, order size: 0.00000844
2018-06-20 12:48:08,155 - INFO - 
2018-06-20 12:48:08,155 - INFO - Entering place_orders function...
2018-06-20 12:48:08,155 - INFO - Getting reference market order book for: WAX/ETH
2018-06-20 12:48:08,399 - INFO - Current best bid at: 0.00004100
2018-06-20 12:48:08,400 - INFO - Current best ask at: 0.03897700
2018-06-20 12:48:08,400 - INFO - Calculating difference between two last orders, lowest diff: bids
2018-06-20 12:48:08,401 - INFO - Calculating difference between two last orders, lowest diff: asks
2018-06-20 12:48:08,401 - INFO - Is current orders at best: {'bid': True, 'ask': False}
2018-06-20 12:48:08,401 - INFO - Spread is about: 94965.85%
2018-06-20 12:48:08,401 - INFO - Checking whether bid and ask are better then ref market: {'bid': True, 'ask': True}
2018-06-20 12:48:08,402 - INFO - Found placed orders on trading market
2018-06-20 12:48:08,653 - INFO - checking current bid status 'open': 19eb87f4-198f-4709-8cae-dbe3b171eb62
2018-06-20 12:48:08,654 - INFO - checking whether bid price: 0.00004100 is relevant
2018-06-20 12:48:08,897 - INFO - checking current ask status 'canceled': 9ed61583-15ce-4f6a-a175-0e13ffd4476d
2018-06-20 12:48:08,897 - INFO - Order is already closed. Deleting from dict 'placed_orders'...
2018-06-20 12:48:08,897 - INFO - Too small amount to place
2018-06-20 12:48:08,898 - INFO - WAX: amount: 0 < 2.5
2018-06-20 12:48:08,898 - INFO - 
2018-06-20 12:48:08,898 - INFO - going to sleep for: 15 seconds







#New Bug:
I still sometimes get the following error:
Saids-MBP:lykke_market_maker said.salem$ python3.6 main.py 
2018-06-20 12:46:56,993 - INFO - Starting Bot ...
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 366, in fetch
    response.raise_for_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/models.py", line 935, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://hft-api.lykke.com/api/AssetPairs

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "main.py", line 17, in <module>
    placed_orders = init_placed_orders(lykke)
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/common.py", line 16, in init_placed_orders
    orders = market.fetch_orders()
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/structures.py", line 23, in method
    return attr(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/lykke.py", line 282, in fetch_orders
    self.load_markets()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 914, in load_markets
    markets = self.fetch_markets()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/lykke.py", line 139, in fetch_markets
    markets = self.publicGetAssetPairs()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 308, in request
    return self.fetch2(path, api, method, params, headers, body)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 305, in fetch2
    return self.fetch(request['url'], request['method'], request['headers'], request['body'])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 379, in fetch
    self.handle_rest_errors(e, response.status_code, self.last_http_response, url, method)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 408, in handle_rest_errors
    self.raise_error(error, url, method, exception if exception else http_status_code, response)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 290, in raise_error
    raise exception_type(output)
ccxt.base.errors.DDoSProtection: lykke https://hft-api.lykke.com/api/AssetPairs GET 429 Client Error: Too Many Requests for url: https://hft-api.lykke.com/api/AssetPairs API calls quota exceeded! maximum admitted 300 per 1m.
Saids-MBP:lykke_market_maker said.salem$ 





#New Bug:

2018-06-19 17:15:31,468 - INFO - Entering place_orders function...
2018-06-19 17:15:31,469 - INFO - Getting reference market order book for: WAX/ETH
2018-06-19 17:15:31,709 - INFO - Current best bid at: 0.00013000
2018-06-19 17:15:31,709 - INFO - Current best ask at: 0.03897700
2018-06-19 17:15:31,709 - INFO - Calculating difference between two last orders, lowest diff: bids
2018-06-19 17:15:31,710 - INFO - Calculating difference between two last orders, lowest diff: asks
2018-06-19 17:15:31,710 - INFO - Is current orders at best: {'bid': False, 'ask': False}
2018-06-19 17:15:31,710 - INFO - Spread is about: 29882.31%
2018-06-19 17:15:31,711 - INFO - Checking whether bid and ask are better then ref market: {'bid': False, 'ask': True}
2018-06-19 17:15:31,711 - INFO - 
2018-06-19 17:15:31,711 - INFO - going to sleep for: 15 seconds

2018-06-19 18:19:00,176 - INFO - Fetching free balance ...
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 387, in _make_request
    six.raise_from(e, None)
  File "<string>", line 2, in raise_from
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 383, in _make_request
    httplib_response = conn.getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 1331, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 297, in begin
    version, status, reason = self._read_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 258, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 586, in readinto
    return self._sock.recv_into(b)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 1009, in recv_into
    return self.read(nbytes, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 871, in read
    return self._sslobj.read(len, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 631, in read
    v = self._sslobj.read(len, buffer)
socket.timeout: The read operation timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 440, in send
    timeout=timeout
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 639, in urlopen
    _stacktrace=sys.exc_info()[2])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/util/retry.py", line 357, in increment
    raise six.reraise(type(error), error, _stacktrace)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/packages/six.py", line 686, in reraise
    raise value
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 601, in urlopen
    chunked=chunked)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 389, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 309, in _raise_timeout
    raise ReadTimeoutError(self, url, "Read timed out. (read timeout=%s)" % timeout_value)
urllib3.exceptions.ReadTimeoutError: HTTPSConnectionPool(host='hft-api.lykke.com', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 359, in fetch
    proxies=self.proxies
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 521, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPSConnectionPool(host='hft-api.lykke.com', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "main.py", line 32, in <module>
    coins_balances = get_coins_balances(placing_objects.market)
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/main_funcs.py", line 8, in get_coins_balances
    balance = market.fetch_balance()
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/structures.py", line 23, in method
    return attr(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/lykke.py", line 101, in fetch_balance
    balances = self.privateGetWallets()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 308, in request
    return self.fetch2(path, api, method, params, headers, body)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 305, in fetch2
    return self.fetch(request['url'], request['method'], request['headers'], request['body'])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 369, in fetch
    self.raise_error(RequestTimeout, method, url, e)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 290, in raise_error
    raise exception_type(output)
ccxt.base.errors.RequestTimeout: lykke GET https://hft-api.lykke.com/api/Wallets HTTPSConnectionPool(host='hft-api.lykke.com', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "main.py", line 46, in <module>
    send_message(header, text)
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/common.py", line 180, in send_message
    with smtplib.SMTP_SSL('smtp.google.com', 587) as server:
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/smtplib.py", line 1030, in __init__
    source_address)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/smtplib.py", line 251, in __init__
    (code, msg) = self.connect(host, port)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/smtplib.py", line 336, in connect
    self.sock = self._get_socket(host, port, self.timeout)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/smtplib.py", line 1036, in _get_socket
    self.source_address)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 704, in create_connection
    for res in getaddrinfo(host, port, 0, SOCK_STREAM):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 745, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
socket.gaierror: [Errno 8] nodename nor servname provided, or not known







///// Fixed


# Fixed: added sleep for rateLimit milliseconds after every call to market
# Added caching of order books for ref exchanges. Order book's relevancy is defined by constant variable REF_BOOK_RELEVANCE_TIME
# Added handling of RequestTimeout exceptions
Bug #1:
Cause: too many requests sent to a ref exchange in a short period of time
Solution:
-1) reduce the calls to the ref exchange. Checking the price for the ref exchange every 5 min is fine. You can get the price for the reference markets, save it, and use it for the next 5min. Then you can request the price again and update it.
This should not affect the spread checking. Spread checking should be done in shorter period.

-2) Handle the thrown exception -> log msg " Too many requests sent to #exchangeName" => Retry after randometime between 3min and 5min. If after second try we get same error increase wait time +2 min. Always do that until the request is successful
==> Use this error handling for all api request, also for Lykke. The program should keep working even after such errors!


Bug error msg:

INFO:root:Found placed orders
INFO:root:checking current bid status a3e6997c-d78c-4908-807f-8a234ee78d98 : canceled
and ask status f240c0cb-df9a-4982-b8ff-a08145ea2b17 : canceled 

INFO:root:Orders are already closed. Deleting from dict 'placed_orders'...
INFO:root:going to sleep for: 15
INFO:root:Entering place_orders func, pair: WAX/ETH
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 387, in _make_request
    six.raise_from(e, None)
  File "<string>", line 2, in raise_from
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 383, in _make_request
    httplib_response = conn.getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 1331, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 297, in begin
    version, status, reason = self._read_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 258, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 586, in readinto
    return self._sock.recv_into(b)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 1009, in recv_into
    return self.read(nbytes, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 871, in read
    return self._sslobj.read(len, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 631, in read
    v = self._sslobj.read(len, buffer)
socket.timeout: The read operation timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 440, in send
    timeout=timeout
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 639, in urlopen
    _stacktrace=sys.exc_info()[2])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/util/retry.py", line 357, in increment
    raise six.reraise(type(error), error, _stacktrace)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/packages/six.py", line 686, in reraise
    raise value
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 601, in urlopen
    chunked=chunked)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 389, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 309, in _raise_timeout
    raise ReadTimeoutError(self, url, "Read timed out. (read timeout=%s)" % timeout_value)
urllib3.exceptions.ReadTimeoutError: HTTPSConnectionPool(host='bittrex.com', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 357, in fetch
    proxies=self.proxies
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 521, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPSConnectionPool(host='bittrex.com', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "main.py", line 115, in <module>
    place_orders(lykke, placed_orders, coin2_spend_amount, coin1_spend_amount, pair)
  File "main.py", line 19, in place_orders
    ref_book = ref_market.fetch_order_book(pair)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/bittrex.py", line 241, in fetch_order_book
    }, params))
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/bittrex.py", line 680, in request
    response = self.fetch2(path, api, method, params, headers, body)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 303, in fetch2
    return self.fetch(request['url'], request['method'], request['headers'], request['body'])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 367, in fetch
    self.raise_error(RequestTimeout, method, url, e)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 288, in raise_error
    raise exception_type(output)
ccxt.base.errors.RequestTimeout: bittrex GET https://bittrex.com/api/v1.1/public/getorderbook?market=ETH-WAX&type=both HTTPSConnectionPool(host='bittrex.com', port=443): Read timed out. (read timeout=10)

Bug #1#:
Still getting this error:



INFO:root:Found placed orders on trading market
INFO:root:checking current bid status 5e5025bc-e544-4eae-84c4-c661b910bbfe : open
and ask status 9888ff96-6312-4467-b2de-f64c6258244d : open 

INFO:root:checking whether bid price:0.000432 and ask price:0.038995 are relevant
INFO:root:going to sleep for: 15

INFO:root:Fetching free balance ...
INFO:root:+ETH : 0.045893130000000004
INFO:root:Order size for ETH: 0.022946565000000002
INFO:root:+WAX : 12.56
INFO:root:Order size for WAX: 6.28
INFO:root:Entering place_orders func, pair: WAX/ETH
INFO:root:Getting reference market order book for: WAX/ETH
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 387, in _make_request
    six.raise_from(e, None)
  File "<string>", line 2, in raise_from
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 383, in _make_request
    httplib_response = conn.getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 1331, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 297, in begin
    version, status, reason = self._read_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 258, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 586, in readinto
    return self._sock.recv_into(b)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 1009, in recv_into
    return self.read(nbytes, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 871, in read
    return self._sslobj.read(len, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 631, in read
    v = self._sslobj.read(len, buffer)
socket.timeout: The read operation timed out

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 440, in send
    timeout=timeout
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 639, in urlopen
    _stacktrace=sys.exc_info()[2])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/util/retry.py", line 357, in increment
    raise six.reraise(type(error), error, _stacktrace)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/packages/six.py", line 686, in reraise
    raise value
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 601, in urlopen
    chunked=chunked)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 389, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 309, in _raise_timeout
    raise ReadTimeoutError(self, url, "Read timed out. (read timeout=%s)" % timeout_value)
urllib3.exceptions.ReadTimeoutError: HTTPSConnectionPool(host='bittrex.com', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 357, in fetch
    proxies=self.proxies
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 521, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPSConnectionPool(host='bittrex.com', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "main.py", line 128, in <module>
    place_orders(lykke, placed_orders, coin2_spend_amount, coin1_spend_amount, pair)
  File "main.py", line 27, in place_orders
    ref_book = ref_market.fetch_order_book(pair)
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/common.py", line 19, in method
    return attr(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/bittrex.py", line 241, in fetch_order_book
    }, params))
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/bittrex.py", line 680, in request
    response = self.fetch2(path, api, method, params, headers, body)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 303, in fetch2
    return self.fetch(request['url'], request['method'], request['headers'], request['body'])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 367, in fetch
    self.raise_error(RequestTimeout, method, url, e)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 288, in raise_error
    raise exception_type(output)
ccxt.base.errors.RequestTimeout: bittrex GET https://bittrex.com/api/v1.1/public/getorderbook?market=ETH-WAX&type=both HTTPSConnectionPool(host='bittrex.com', port=443): Read timed out. (read timeout=10)



# Fixed: if bid order is placed and ask order is not or vice versa, then that one order is canceled and deleted from dict
Bug#2:
Cause: If sell order is already placed -> Then start the program -> it will lead to the following error:
Saids-MBP:lykke_market_maker said.salem$ python3.6 main.py 
Traceback (most recent call last):
  File "main.py", line 8, in <module>
    placed_orders = init_placed_orders(lykke)
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/common.py", line 73, in init_placed_orders
    placed_orders[pair] = Orders(orders_pair["bid"], orders_pair["ask"])
KeyError: 'bid'

Cause 2: If buy order is placed:

Saids-MBP:lykke_market_maker said.salem$ python3.6 main.py 
Traceback (most recent call last):
  File "main.py", line 8, in <module>
    placed_orders = init_placed_orders(lykke)
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/common.py", line 73, in init_placed_orders
    placed_orders[pair] = Orders(orders_pair["bid"], orders_pair["ask"])
KeyError: 'ask'




# The problem was in placing order with amount that's below minimal size
# Fixed function check_min_size
# Balance is always divided to the parts, and each part is used to place order, so problem with insufficiency of money
# on balance shouldn't arise
Bug3#:
Cause:If Balance not enough:
Solution: Check Balance before putting orders
          - And error handling. Program should not exit!

Bug error msg:

INFO:root:Is situation relevant?: True

INFO:root:No orders were found. Placing orders...
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 364, in fetch
    response.raise_for_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/models.py", line 935, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error: Bad Request for url: https://hft-api.lykke.com/api/Orders/limit

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "main.py", line 115, in <module>
    place_orders(lykke, placed_orders, coin2_spend_amount, coin1_spend_amount, pair)
  File "main.py", line 88, in place_orders
    bid_id = market.create_limit_buy_order(pair, converted_buy_amount, bid_price)['info']
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 1220, in create_limit_buy_order
    return self.create_order(symbol, 'limit', 'buy', *args)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/lykke.py", line 132, in create_order
    result = getattr(self, method)(self.extend(query, params))
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 306, in request
    return self.fetch2(path, api, method, params, headers, body)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 303, in fetch2
    return self.fetch(request['url'], request['method'], request['headers'], request['body'])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 377, in fetch
    self.handle_rest_errors(e, response.status_code, self.last_http_response, url, method)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 406, in handle_rest_errors
    self.raise_error(error, url, method, exception if exception else http_status_code, response)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 288, in raise_error
    raise exception_type(output)
ccxt.base.errors.ExchangeNotAvailable: lykke https://hft-api.lykke.com/api/Orders/limit POST 400 Client Error: Bad Request for url: https://hft-api.lykke.com/api/Orders/limit {"Error":{"Code":"Dust","Field":null,"Message":"The amount should be higher than minimal order size 2.5 WAX"}}



# If unexpected error occurs, then an email with short extract of the log and the exception is sent and program continues
# to work.
Bug #4:

Reason: unknown
Fix: The program should continue running. If it is a new type of exception the program should send me an email with short extract of the log and the exception.
Here are the logs:

  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 601, in urlopen
    chunked=chunked)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 387, in _make_request
    six.raise_from(e, None)
  File "<string>", line 2, in raise_from
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 383, in _make_request
    httplib_response = conn.getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 1331, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 297, in begin
    version, status, reason = self._read_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 258, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 586, in readinto
    return self._sock.recv_into(b)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 1009, in recv_into
    return self.read(nbytes, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 871, in read
    return self._sslobj.read(len, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 631, in read
    v = self._sslobj.read(len, buffer)
ConnectionResetError: [Errno 54] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 440, in send
    timeout=timeout
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 639, in urlopen
    _stacktrace=sys.exc_info()[2])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/util/retry.py", line 357, in increment
    raise six.reraise(type(error), error, _stacktrace)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/packages/six.py", line 685, in reraise
    raise value.with_traceback(tb)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 601, in urlopen
    chunked=chunked)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 387, in _make_request
    six.raise_from(e, None)
  File "<string>", line 2, in raise_from
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 383, in _make_request
    httplib_response = conn.getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 1331, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 297, in begin
    version, status, reason = self._read_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 258, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 586, in readinto
    return self._sock.recv_into(b)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 1009, in recv_into
    return self.read(nbytes, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 871, in read
    return self._sslobj.read(len, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 631, in read
    v = self._sslobj.read(len, buffer)
urllib3.exceptions.ProtocolError: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 357, in fetch
    proxies=self.proxies
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 490, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "main.py", line 158, in <module>
    place_orders(lykke, placed_orders, coin2_spend_amount, coin1_spend_amount, pair)
  File "main.py", line 13, in place_orders
    ref_book = get_ref_book(pair, opened_ref_markets, cached_ref_books)
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/common.py", line 35, in get_ref_book
    cached_ref_book.update_value(ref_market.fetch_order_book(pair))
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/structures.py", line 23, in method
    return attr(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/bittrex.py", line 241, in fetch_order_book
    }, params))
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/bittrex.py", line 680, in request
    response = self.fetch2(path, api, method, params, headers, body)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 303, in fetch2
    return self.fetch(request['url'], request['method'], request['headers'], request['body'])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 381, in fetch
    self.raise_error(ExchangeError, url, method, e, self.last_http_response)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 288, in raise_error
    raise exception_type(output)
ccxt.base.errors.ExchangeError: bittrex https://bittrex.com/api/v1.1/public/getorderbook?market=ETH-WAX&type=both GET ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer')) {"success":true,"message":"","result":{"buy":[{"Quantity":2535.20780982,"Rate":0.00032861},{"Quantity":831.54600000,"Rate":0.00032860},{"Quantity":3567.31438489,"Rate":0.00032857},{"Quantity":6159.43100000,"Rate":0.00032286},{"Quantity":5203.65494810,"Rate":0.00032285},{"Quantity":17067.27790856,"Rate":0.00032284},{"Quantity":1633.74765345,"Rate":0.00032241},{"Quantity":229.68089667,"Rate":0.00032000},{"Quantity":25.24152594,"Rate":0.00031944},{"Quantity":10.00000000,"Rate":0.00031800},{"Quantity":22.82851200,"Rate":0.00031795},{"Quantity":13.67741208,"Rate":0.00031582},{"Quantity":7618.56390070,"Rate":0.00031502},{"Quantity":6808.11720263,"Rate":0.00031501},{"Quantity":3321.83333333,"Rate":0.00031500},{"Quantity":100.00000000,"Rate":0.00031441},{"Quantity":506.02132892,"Rate":0.00031011},{"Quantity":30.00000000,"Rate":0.00031000},{"Quantity":25.00000000,"Rate":0.00030995},{"Quantity":100.00000000,"Rate":0.00030866},{"Quantity":1292.84351283,"Rate":0.00030864},{"Quantity":1000.00000000,"Rate":0.00030697},{"Quantity":2134.04545350,"Rate":0.00030000},{"Quantity":548.81392353,"Rate":0.00029520},{"Quantity":1781.25000000,"Rate":0.00028000},{"Quantity":31.00000000,"Rate":0.00027507},{"Quantity":36272.72727273,"Rate":0.00027500},{"Quantity":18.75018750,"Rate":0.00026600},{"Quantity":60.00000000,"Rate":0.00025007},{"Quantity":500.00000000,"Rate":0.00025000},{"Quantity":90.00000000,"Rate":0.00022507},{"Quantity":120.00000000,"Rate":0.00020007},{"Quantity":240.00000000,"Rate":0.00017507},{"Quantity":700.00000000,"Rate":0.00017500},{"Quantity":13800.69102517,"Rate":0.00010608},{"Quantity":20000.00000000,"Rate":0.00000300},{"Quantity":100000.00000000,"Rate":0.00000011},{"Quantity":200000.00000000,"Rate":0.00000006},{"Quantity":200000.00000000,"Rate":0.00000001}],"sell":[{"Quantity":106.45228718,"Rate":0.00033425},{"Quantity":140.64104223,"Rate":0.00033426},{"Quantity":29.07141005,"Rate":0.00033428},{"Quantity":10.07354604,"Rate":0.00033462},{"Quantity":98.54758357,"Rate":0.00033881},{"Quantity":7722.56100000,"Rate":0.00033882},{"Quantity":3453.73226881,"Rate":0.00033883},{"Quantity":1139.18020848,"Rate":0.00033981},{"Quantity":89.91008992,"Rate":0.00034396},{"Quantity":35.68497400,"Rate":0.00035000},{"Quantity":25.00000000,"Rate":0.00035035},{"Quantity":611.63088387,"Rate":0.00035588},{"Quantity":853.53249803,"Rate":0.00035589},{"Quantity":10.00000000,"Rate":0.00035607},{"Quantity":56.94285002,"Rate":0.00035626},{"Quantity":1000.00000000,"Rate":0.00035800},{"Quantity":26.00385954,"Rate":0.00035900},{"Quantity":15.69810726,"Rate":0.00036000},{"Quantity":207.58902613,"Rate":0.00036100},{"Quantity":329.93525017,"Rate":0.00036489},{"Quantity":364.29668681,"Rate":0.00036971},{"Quantity":143.09815026,"Rate":0.00037177},{"Quantity":1189.44333073,"Rate":0.00037903},{"Quantity":187.66571017,"Rate":0.00038077},{"Quantity":121.82070784,"Rate":0.00038269},{"Quantity":2800.00000000,"Rate":0.00038380},{"Quantity":51.00000000,"Rate":0.00038850},{"Quantity":2146.00000000,"Rate":0.00038879},{"Quantity":2874.00000000,"Rate":0.00038880},{"Quantity":2877.00000000,"Rate":0.00038881},{"Quantity":2144.00000000,"Rate":0.00038882},{"Quantity":2367.00000000,"Rate":0.00038883},{"Quantity":2425.00000000,"Rate":0.00038884},{"Quantity":3320.37613031,"Rate":0.00038885},{"Quantity":291.63794475,"Rate":0.00038891},{"Quantity":52.42051739,"Rate":0.00039492},{"Quantity":2230.64061993,"Rate":0.00039900},{"Quantity":1894.29355102,"Rate":0.00040000},{"Quantity":808.11905601,"Rate":0.00040370},{"Quantity":1454.14842172,"Rate":0.00041000},{"Quantity":869.87007546,"Rate":0.00042000},{"Quantity":20.00000000,"Rate":0.00042200},{"Quantity":17.84248700,"Rate":0.00042500},{"Quantity":1229.26576788,"Rate":0.00042998},{"Quantity":117.84248700,"Rate":0.00045000},{"Quantity":163.42278581,"Rate":0.00045280},{"Quantity":578.16077896,"Rate":0.00045500},{"Quantity":3000.00000000,"Rate":0.00047000},{"Quantity":317.84248700,"Rate":0.00047500},{"Quantity":2999.00000000,"Rate":0.00049000},{"Quantity":20.00000000,"Rate":0.00049700},{"Quantity":315.21567388,"Rate":0.00049720},{"Quantity":290.35790174,"Rate":0.00049875},{"Quantity":21.82713348,"Rate":0.00050300},{"Quantity":239.37717994,"Rate":0.00050919},{"Quantity":166.75403996,"Rate":0.00051000},{"Quantity":199.87531135,"Rate":0.00051379},{"Quantity":750.00000000,"Rate":0.00052000},{"Quantity":8.92124350,"Rate":0.00052500},{"Quantity":25000.00000000,"Rate":0.00053353},{"Quantity":45.00000000,"Rate":0.00053976},{"Quantity":383.48590215,"Rate":0.00054521},{"Quantity":390.17760017,"Rate":0.00055000},{"Quantity":979.36363636,"Rate":0.00055758},{"Quantity":900.00000000,"Rate":0.00056000},{"Quantity":19.44444444,"Rate":0.00056500},{"Quantity":7852.07933953,"Rate":0.00056900},{"Quantity":73.86563489,"Rate":0.00056932},{"Quantity":554.17692920,"Rate":0.00056999},{"Quantity":151.31895288,"Rate":0.00057000},{"Quantity":135.83642259,"Rate":0.00057080},{"Quantity":30.00000000,"Rate":0.00057717},{"Quantity":1129.05890248,"Rate":0.00057750},{"Quantity":1000.00000000,"Rate":0.00057900},{"Quantity":22.03137721,"Rate":0.00057915},{"Quantity":50.00000000,"Rate":0.00057976},{"Quantity":50.00000000,"Rate":0.00058000},{"Quantity":1000.00000000,"Rate":0.00058100},{"Quantity":1000.00000000,"Rate":0.00058300},{"Quantity":20.00000000,"Rate":0.00058500},{"Quantity":1181.81818182,"Rate":0.00058600},{"Quantity":12950.00000000,"Rate":0.00058888},{"Quantity":386.41327345,"Rate":0.00059000},{"Quantity":180.76552046,"Rate":0.00059525},{"Quantity":340.44949573,"Rate":0.00059788},{"Quantity":50.00000000,"Rate":0.00059976},{"Quantity":9.00000000,"Rate":0.00059988},{"Quantity":10217.27374541,"Rate":0.00060000},{"Quantity":68.51309457,"Rate":0.00060375},{"Quantity":885.29912397,"Rate":0.00061200},{"Quantity":213.66776961,"Rate":0.00063000},{"Quantity":2588.09967019,"Rate":0.00063330},{"Quantity":17.28769497,"Rate":0.00063400},{"Quantity":208.96701883,"Rate":0.00065625},{"Quantity":163.84212996,"Rate":0.00065722},{"Quantity":941.20373400,"Rate":0.00065960},{"Quantity":7308.58501786,"Rate":0.00066203},{"Quantity":16.40625000,"Rate":0.00067000},{"Quantity":15.05394675,"Rate":0.00067729},{"Quantity":4108.72299506,"Rate":0.00068799}]}}



Bug #3:
Reason: unknown
Fix: The program should continue running. If it is a new type of exception the program should send me an email with short extract of the log and the exception.
Here are the logs:



INFO:root:Is orders are relevant?
{'bid': True, 'ask': True}
INFO:root:Found placed orders on trading market
INFO:root:checking current bid status 'open': e3f88963-2bcf-46ad-93b4-18564a0cc4e1

INFO:root:checking whether bid price: 0.00003300 is relevant
INFO:root:Too small amount to place
INFO:root:WAX: amount: 0 < 2.5
INFO:root:going to sleep for: 15

INFO:root:Fetching free balance ...
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 601, in urlopen
    chunked=chunked)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 387, in _make_request
    six.raise_from(e, None)
  File "<string>", line 2, in raise_from
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 383, in _make_request
    httplib_response = conn.getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 1331, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 297, in begin
    version, status, reason = self._read_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 258, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 586, in readinto
    return self._sock.recv_into(b)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 1009, in recv_into
    return self.read(nbytes, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 871, in read
    return self._sslobj.read(len, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 631, in read
    v = self._sslobj.read(len, buffer)
ConnectionResetError: [Errno 54] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 440, in send
    timeout=timeout
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 639, in urlopen
    _stacktrace=sys.exc_info()[2])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/util/retry.py", line 357, in increment
    raise six.reraise(type(error), error, _stacktrace)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/packages/six.py", line 685, in reraise
    raise value.with_traceback(tb)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 601, in urlopen
    chunked=chunked)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 387, in _make_request
    six.raise_from(e, None)
  File "<string>", line 2, in raise_from
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/urllib3/connectionpool.py", line 383, in _make_request
    httplib_response = conn.getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 1331, in getresponse
    response.begin()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 297, in begin
    version, status, reason = self._read_status()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/http/client.py", line 258, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/socket.py", line 586, in readinto
    return self._sock.recv_into(b)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 1009, in recv_into
    return self.read(nbytes, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 871, in read
    return self._sslobj.read(len, buffer)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/ssl.py", line 631, in read
    v = self._sslobj.read(len, buffer)
urllib3.exceptions.ProtocolError: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 357, in fetch
    proxies=self.proxies
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 508, in request
    resp = self.send(prep, **send_kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/sessions.py", line 618, in send
    r = adapter.send(request, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/requests/adapters.py", line 490, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "main.py", line 117, in <module>
    balance = lykke.fetch_balance()
  File "/Users/said.salem/ownCloud/Trading/LykkeAPI/lykke_market_maker/structures.py", line 23, in method
    return attr(*args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/lykke.py", line 101, in fetch_balance
    balances = self.privateGetWallets()
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 306, in request
    return self.fetch2(path, api, method, params, headers, body)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 303, in fetch2
    return self.fetch(request['url'], request['method'], request['headers'], request['body'])
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 381, in fetch
    self.raise_error(ExchangeError, url, method, e, self.last_http_response)
  File "/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/ccxt/base/exchange.py", line 288, in raise_error
    raise exception_type(output)
ccxt.base.errors.ExchangeError: lykke https://hft-api.lykke.com/api/Wallets GET ('Connection aborted.', ConnectionResetError(54, 'Connection reset by peer')) {"Id":"e3f88963-2bcf-46ad-93b4-18564a0cc4e1","Status":"InOrderBook","AssetPairId":"WAXETH","Volume":567.0,"Price":3.3E-05,"RemainingVolume":567.0,"LastMatchTime":null,"CreatedAt":"2018-05-28T08:50:17.854Z"}
Saids-MBP:lykke_market_maker said.salem$